# TSN Test Case Generator

A Python tool for generating and validating Time-Sensitive Network (TSN) test cases. This tool creates and validates `topology.json`, `streams.json`, and `routes.json` files based on a configuration file `*_config.json`.

## Features

- **Multi-domain support**: Generate topologies with multiple TSN domains
- **Flexible topology generation**: Create various network topologies using NetworkX or custom generators
- **Traffic pattern generation**: Generate different types of traffic flows with configurable properties
- **Route computation**: Compute shortest paths or balanced paths for streams
- **Universal validation**: Validate any TSN JSON file (config, topology, streams, routes) against its schema
- **Reproducibility**: Set a random seed for deterministic test case generation

## Installation

### Requirements

- Python 3.8+
- NetworkX 3.0+
- jsonschema 4.0+
- pydantic 2.0+
- pytest-mock 3.14.0+
- pytest 8.3.5+
- numpy 2.2.5+

### Using pip

```bash
pip install .
```

### Development Installation

```bash
pip install -e .
```

## Usage

### Basic Command

```bash
tsn-case-gen --config=<path_to_config_file>
```

### Options

- `--config`: Path to the configuration file (required for generation)
- `--json`: Path to any TSN JSON file to validate (for validation)
- `--seed`: Random seed for reproducibility (optional)
- `--verbose`: Enable verbose logging (optional)

### Validation Command (Universal)

You can validate any TSN JSON file (config, topology, streams, routes) using the CLI:

```bash
tsn-case-gen validate --json <path_to_json_file>
```

- The validator will automatically detect the file type and validate it against the correct schema.
- If the file is valid, you will see a message like:
  - `Valid routes.json structure (jsonschema)`
  - `Valid config structure (Pydantic)`
- If the file is invalid or does not match any schema, you will see:
  - `No matching schema found or validation failed.`

### Type Checking

```bash
tsn-case-gen lint
```

### Tool Info

```bash
tsn-case-gen info
```

## Configuration

The generator is configured using a `*_config.json` file that specifies topology, traffic, and routing parameters.

An example template is provided below. For complete field definitions and options, refer to [file_format_specs.v2.md](docs/file_format_specs.v2.md).

```json
{
  "delay_units": "MICRO_SECOND",
  "general": { ... },
  "network": { ... },
  "domain_connections": { ... },
  "routing": { ... },
  "traffic": { ... }
}
```

### Configuration Details

For a complete list of configuration fields (including `network`, `domain_connections`, `routing`, and `traffic`), refer to the specification:

[Configuration File Format Specification](docs/file_format_specs.v2.md)

### Configuration GUI

A graphical user interface (GUI) is provided to assist in creating and editing `*_config.json` files. To launch it, run:

```bash
python3 tsn_case_gen_/cli/UI.py
```

This is still in development so it only has the traffic types from the industrial profile.
When configured, save the file in the repository and use this as the configuration file when running the test case generator.

### Example Configurations

Several example configuration files are provided in `examples/configs/` for different scenarios:

- `industrial_config.json`: Configuration tailored for industrial network scenarios.
- `automotive_config.json`: Example settings relevant to automotive networks.
- `aerospace_config.json`: Configuration example for aerospace use cases.

These can be used as templates or starting points for creating custom configurations.

## Output File Formats

The generator creates the following files for each test case:

- **`topology.json`**: Defines the network structure (nodes and links).
- **`streams.json`**: Describes the TSN traffic flows.
- **`routes.json`** (optional): Contains pre-computed routes for streams.

For detailed field definitions and schema, refer to [file_format_specs.v2.md](docs/file_format_specs.v2.md).

NOTE: The files `schedules.json` and `gcls.json` are not generated by this tool but are outputs of a downstream TSN scheduling component. Their format is also documented in `file_format_specs.v2.md`.

## Examples

The `examples/` directory contains pre-generated test cases that can be used for testing your TSN analysis:

- `examples/small_tests_config.json`: The configuration file used to generate the test cases below.
- `examples/test_case_1/`: First test case (topology, streams, routes).
- `examples/test_case_2/`: Second test case (topology, streams, routes).
- `examples/test_case_3/`: Third test case (topology, streams, routes).
- `examples/configs/`: Example configuration files for different domains (industrial, automotive, aerospace).

Each test case directory contains:
- `topology.json` - Network topology with switches and end systems
- `streams.json` - Traffic streams with timing requirements
- `routes.json` - Pre-computed routes for all streams

## Testing

Run all tests with:

```bash
pytest
```

## Documentation

- See `docs/file_format_specs.v2.md` for the JSON file format specification.
- See `docs/architecture.md` for the high-level software architecture.

## Changelog & Versioning Policy

- Versioning follows [Semantic Versioning (SemVer)](https://semver.org/): MAJOR.MINOR.PATCH
- See `CHANGELOG.md` for release notes and changes.

## License

MIT License
